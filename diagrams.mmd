graph TD
    %% 1. HIGH-LEVEL ARCHITECTURE
    subgraph "ðŸš€ Bootstrapping Layer"
        Launcher[Qwen3_Launcher.exe] -- Downloads --> AppCore[App Core ZIP]
        AppCore -- Unpacks to --> LocalAppData[%LOCALAPPDATA%]
        Setup[Qwen3_Studio_Setup.exe] -- Verifies --> Engine[AI Engine 4.5GB]
    end

    subgraph "ðŸŽ¨ Triple Pavilion Architecture"
        MainApp[Qwen3 Studio Main]
        
        subgraph "Pavilion A: Creative Engines"
            Custom[Custom Voice]
            Design[Voice Design]
            Clone[Voice Clone]
        end

        subgraph "Pavilion B: Production Lab"
            Helper[Transcript Helper]
            Parser[Script Helper / Text Parser]
            Batch[Batch Studio NLE]
        end

        subgraph "Pavilion C: Extension Hub"
            Hub[Module Hub]
            Registry[enabled_modules.json]
            OfficialRepo[(GitHub Master)]
        end
    end

    subgraph "âš™ï¸ Backend & Infrastructure"
        Inference[Qwen2.5-Audio Model]
        SoxProc[SoX Audio Processor]
        VRAM[VRAM Monitor]
    end

    %% Interactions
    MainApp --> Hub
    Hub -- Syncs --> OfficialRepo
    Hub -- Persists --> Registry
    Registry -- Filters --> MainApp
    
    Parser -- Prepares --> Batch
    Helper -- Feeds --> Clone
    
    Batch -- Calls --> Inference
    Inference -- Post-Process --> SoxProc
    VRAM -- Protects --> Inference

    %% 2. THE DIRECTOR'S WORKFLOW
    subgraph "ðŸŽ¬ Creative Workflow"
        InputText[Long Document/Script] --> ScriptHelper[Script Helper]
        ScriptHelper -- "Split & Clean" --> Blocks[Batch Blocks]
        
        RefAudio[Reference Audio] --> TransHelper[Transcript Helper]
        TransHelper -- "Whisper AI" --> VoiceProfile[Clone Profile]
        
        Blocks & VoiceProfile --> NLE[Batch Studio]
        NLE -- "Sequential Render" --> Stitch[Audio Stitching]
        Stitch -- "Final Output" --> FinalExport[WAV / MP3 Export]
    end

    %% 3. MODULE HUB LOGIC (SEQUENCE FLOW)
    subgraph "ðŸ”Œ Module Hub Sync Sequence"
        UI_Sync[Check for New Plugins] --> API_Fetch[GitHub REST API]
        API_Fetch -- "File List" --> Local_Compare{Compare Hashes}
        Local_Compare -- "Missing/New" --> Download[Raw Download]
        Download -- "Yellow Dot" --> UI_Refresh[Update List View]
        UI_Refresh -- "Toggle Active" --> Registry_Save[enabled_modules.json]
    end

    %% Styling
    style Launcher fill:#f9f,stroke:#333,stroke-width:2px
    style OfficialRepo fill:#3498db,color:#fff
    style MainApp fill:#2ecc71,color:#fff
    style Inference fill:#e74c3c,color:#fff
    style VRAM fill:#f1c40f,stroke:#333
